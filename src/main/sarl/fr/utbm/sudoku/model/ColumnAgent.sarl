/** 
 * 
 */
package fr.utbm.sudoku.model

import fr.utbm.sudoku.events.ColAgentSpawned
import fr.utbm.sudoku.events.ColInitialized
import fr.utbm.sudoku.events.PositionY
import io.sarl.core.DefaultContextInteractions
import io.sarl.core.Initialize
import io.sarl.core.InnerContextAccess
import io.sarl.core.Logging
import java.util.HashMap
import java.util.List
import java.util.UUID

/** 
 * @author Clément Bareth-Desgranges <clement.bareth@gmail.com>
 * 
 */
agent ColumnAgent extends RegionAgent {
	uses Logging, InnerContextAccess, DefaultContextInteractions

	var colNum : Integer
	var colValues : List<Integer>
	var agents = new  HashMap<Integer,UUID>

	on Initialize {
		if (occurrence.parameters.length >= 2) {
			this.colNum = occurrence.parameters.get(0) as Integer
			this.colValues = occurrence.parameters.get(1) as List<Integer>
			loggingName = "ColumnAgent n° " + colNum
		}
		
		emit(new ColAgentSpawned => [
			num = colNum;
			contextId = innerContext.ID;
			^space = innerContext.defaultSpace;
			Id = ID;
			
		])
	}

	def countZeros : Integer {
		var j = 0;
		for (i : colValues) {
			if (i == 0) {
				j++
			}
		}
		return j;
	}

	on PositionY {
		synchronized (agents) {
			agents.put(occurrence.pos, occurrence.id)
			info("Agent "+occurrence.id+" ajouté en " + occurrence.pos)
			if (agents.size == countZeros) {
				emit(new ColInitialized => [id = ID])
			}
		}
	}
}
